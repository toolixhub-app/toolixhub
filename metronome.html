<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Metronome - ToolixHub</title>
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #eef2f7;
  margin: 0;
  padding: 50px 20px;
}

h1 {
  color: #4a90e2;
  margin-bottom: 20px;
}

#controls {
  margin-bottom: 60px;
}

input[type=range], select {
  width: 250px;
  margin: 10px 0;
  font-size: 16px;
}

button {
  font-size: 18px;
  padding: 10px 20px;
  margin: 5px;
  border: none;
  border-radius: 8px;
  background: #4a90e2;
  color: white;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}

button:hover {
  background: #357ABD;
}

#beat {
  font-size: 350px;
  color: #4a90e2;
  margin: 0 auto 20px;
  transition: transform 0.05s;
  line-height: 0.8;
}

#measure {
  font-size: 24px;
  color: #555;
  margin-bottom: 30px;
}

@media (max-width: 600px) {
  #beat { font-size: 200px; }
  input[type=range], select { width: 200px; }
}
</style>
</head>
<body>

<h1>üéµ Metronome</h1>

<div id="controls">
  <label for="bpmSlider">BPM: <span id="bpmValue">60</span></label><br>
  <input type="range" id="bpmSlider" min="30" max="300" value="60"><br>

  <label for="beatsPerMeasure">Beats per measure:</label><br>
  <select id="beatsPerMeasure">
    <option value="2">2/4</option>
    <option value="3">3/4</option>
    <option value="4" selected>4/4</option>
    <option value="5">5/4</option>
    <option value="6">6/4</option>
  </select><br>

  <button onclick="start()">Start</button>
  <button onclick="stop()">Stop</button>
</div>

<div id="beat">‚óè</div>
<div id="measure">Measure: 0 / 4</div>

<script>
// Web Audio API
let audioCtx;
function playClick(isAccent=false) {
  if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = audioCtx.createOscillator();
  const gainNode = audioCtx.createGain();
  osc.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  osc.type = 'square';
  osc.frequency.value = isAccent ? 1000 : 700;
  gainNode.gain.value = 0.2;
  osc.start();
  osc.stop(audioCtx.currentTime + 0.05);
}

// Elements
const beatEl = document.getElementById('beat');
const measureEl = document.getElementById('measure');
const bpmSlider = document.getElementById('bpmSlider');
const bpmValue = document.getElementById('bpmValue');
const beatsPerMeasureSelect = document.getElementById('beatsPerMeasure');

let interval;
let beatCount = 0;

// Slider live update
bpmSlider.oninput = () => bpmValue.textContent = bpmSlider.value;

// Start Metronome
function start() {
  stop();
  let bpm = parseInt(bpmSlider.value);
  let ms = 60000 / bpm;
  let beatsPerMeasure = parseInt(beatsPerMeasureSelect.value);
  beatCount = 0;

  interval = setInterval(() => {
    beatCount = (beatCount % beatsPerMeasure) + 1;

    // Pulsar bolinha
    beatEl.style.transform = 'scale(1.2)';
    setTimeout(() => beatEl.style.transform = 'scale(1)', ms/2);

    // Som
    playClick(beatCount === 1);

    // Atualiza medida
    measureEl.textContent = `Measure: ${beatCount} / ${beatsPerMeasure}`;
  }, ms);
}

// Stop Metronome
function stop() {
  clearInterval(interval);
  beatEl.style.transform = 'scale(1)';
  beatCount = 0;
  let beatsPerMeasure = parseInt(beatsPerMeasureSelect.value);
  measureEl.textContent = `Measure: 0 / ${beatsPerMeasure}`;
}
</script>

</body>
</html>
