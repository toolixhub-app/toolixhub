<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Metronome 1.1 - ToolixHub</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background: linear-gradient(160deg, #eef2f7, #cce0ff);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  min-height: 100vh;
  overflow: hidden;
}

h1 {
  color: #4a90e2;
  margin-top: 30px;
}

#description {
  font-size: 16px;
  color: #555;
  margin: 10px 0 30px 0;
  text-align: center;
  max-width: 600px;
}

#controls {
  margin-bottom: 40px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

input[type=range], select {
  width: 250px;
  margin: 10px 0;
  font-size: 16px;
}

button {
  font-size: 24px;
  padding: 10px 15px;
  margin: 5px;
  border: none;
  border-radius: 8px;
  background: #4a90e2;
  color: white;
  cursor: pointer;
  transition: 0.2s;
}

button:hover {
  background: #357ABD;
}

#metronome {
  position: relative;
  width: 300px;
  height: 300px;
  margin-bottom: 20px;
}

#beat {
  position: absolute;
  width: 20px;
  height: 150px;
  top: 50%;
  left: 50%;
  transform-origin: bottom center;
  background: radial-gradient(circle, #4a90e2 0%, #1c5bbf 70%);
  border-radius: 10px;
  transform: rotate(0deg);
  transition: transform 0.05s linear;
}

#pulse {
  position: absolute;
  width: 300px;
  height: 300px;
  border-radius: 50%;
  top: 0;
  left: 0;
  background: rgba(74,144,226,0.2);
  pointer-events: none;
}

@keyframes pulseAnim {
  0% { transform: scale(0.8); opacity: 0; }
  50% { transform: scale(1.2); opacity: 0.3; }
  100% { transform: scale(0.8); opacity: 0; }
}

#measure {
  font-size: 24px;
  color: #555;
  margin-bottom: 20px;
}

footer {
  font-size: 12px;
  color: #999;
  position: absolute;
  bottom: 10px;
}

@media (max-width: 600px) {
  #metronome { width: 200px; height: 200px; }
  #beat { height: 100px; width: 15px; }
  input[type=range], select { width: 200px; }
  button { font-size: 20px; padding: 8px 12px; }
}
</style>
</head>
<body>

<h1>üéµ Metronome 1.1</h1>
<div id="description">
Use este metr√¥nomo para manter o tempo de suas m√∫sicas, ensaios ou exerc√≠cios r√≠tmicos. Ajuste o BPM e o n√∫mero de batidas por compasso. Voc√™ pode ativar ou desativar o som.
</div>

<div id="controls">
  <label for="bpmSlider">BPM: <span id="bpmValue">60</span></label><br>
  <input type="range" id="bpmSlider" min="30" max="300" value="60"><br>

  <label for="beatsPerMeasure">Beats per measure:</label><br>
  <select id="beatsPerMeasure">
    <option value="2">2/4</option>
    <option value="3">3/4</option>
    <option value="4" selected>4/4</option>
    <option value="5">5/4</option>
    <option value="6">6/4</option>
  </select><br>

  <div>
    <button id="playBtn">‚ñ∂</button>
    <button id="pauseBtn">‚è∏</button>
    <button id="stopBtn">‚ñ†</button>
    <button id="soundBtn">üîä</button>
  </div>
</div>

<div id="metronome">
  <div id="pulse"></div>
  <div id="beat"></div>
</div>
<div id="measure">Measure: 0 / 4</div>
<footer>Version 1.1</footer>

<script>
// --- Web Audio API ---
let audioCtx;
let soundEnabled = true;

function playClick(isAccent=false) {
  if(!soundEnabled) return;
  if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = audioCtx.createOscillator();
  const gainNode = audioCtx.createGain();
  osc.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  osc.type = 'square';
  osc.frequency.value = isAccent ? 1200 : 700; 
  gainNode.gain.value = 0.25;
  osc.start();
  osc.stop(audioCtx.currentTime + 0.05);
}

// --- Elementos ---
const beatEl = document.getElementById('beat');
const pulseEl = document.getElementById('pulse');
const measureEl = document.getElementById('measure');
const bpmSlider = document.getElementById('bpmSlider');
const bpmValue = document.getElementById('bpmValue');
const beatsPerMeasureSelect = document.getElementById('beatsPerMeasure');

const playBtn = document.getElementById('playBtn');
const pauseBtn = document.getElementById('pauseBtn');
const stopBtn = document.getElementById('stopBtn');
const soundBtn = document.getElementById('soundBtn');

let beatCount = 0;
let timerId = null;
let isRunning = false;
let isPaused = false;

// Atualiza valor do slider
bpmSlider.oninput = () => bpmValue.textContent = bpmSlider.value;

// Fun√ß√£o do beat
function scheduleBeat() {
  if(!isRunning || isPaused) return;

  const bpm = parseInt(bpmSlider.value);
  const ms = 60000 / bpm;
  const beatsPerMeasure = parseInt(beatsPerMeasureSelect.value);

  beatCount = (beatCount % beatsPerMeasure) + 1;

  // Rota√ß√£o tipo ponteiro centralizado
  const angle = (beatCount-1) * (360 / beatsPerMeasure);
  beatEl.style.transform = `rotate(${angle}deg)`;

  // Som
  playClick(beatCount === 1);

  // Atualiza medida
  measureEl.textContent = `Measure: ${beatCount} / ${beatsPerMeasure}`;

  // Pulse visual
  pulseEl.style.background = `radial-gradient(circle, rgba(74,144,226,0.3) 0%, rgba(28,91,191,0.0) 70%)`;
  pulseEl.style.animation = 'none';
  void pulseEl.offsetWidth; // restart animation
  pulseEl.style.animation = `pulseAnim ${ms}ms linear`;

  // Pr√≥ximo beat
  timerId = setTimeout(scheduleBeat, ms);
}

// --- Controles ---
playBtn.onclick = () => {
  if(!isRunning) {
    isRunning = true;
    isPaused = false;
    scheduleBeat();
  } else if(isPaused) {
    isPaused = false;
    scheduleBeat();
  }
};

pauseBtn.onclick = () => {
  isPaused = true;
  if(timerId) clearTimeout(timerId);
  timerId = null;
};

stopBtn.onclick = () => {
  isRunning = false;
  isPaused = false;
  if(timerId) clearTimeout(timerId);
  timerId = null;
  beatCount = 0;
  measureEl.textContent = `Measure: 0 / ${beatsPerMeasureSelect.value}`;
  beatEl.style.transform = 'rotate(0deg)';
};

soundBtn.onclick = () => {
  soundEnabled = !soundEnabled;
  soundBtn.textContent = soundEnabled ? 'üîä' : 'üîá';
};
</script>

</body>
</html>
