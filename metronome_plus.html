<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Metronome Full</title>
<style>
  body { background: #000; color: #fff; font-family: Arial, sans-serif; text-align: center; }
  .beat { display: inline-block; width: 30px; height: 30px; margin: 5px; border-radius: 50%; background: #444; cursor: pointer; }
  .accent { background: red; }
  .active { border: 2px solid #fff; }
  button { font-size: 24px; margin: 5px; }
  #controls { margin-top: 20px; }
  #bpmValue { font-size: 24px; margin-left: 10px; }
</style>
</head>
<body>

<h1>Metronome Full</h1>

<label for="beatsPerMeasure">Beats per measure:</label><br>
<select id="beatsPerMeasure">
  <option value="2">2/4</option>
  <option value="3">3/4</option>
  <option value="4" selected>4/4</option>
  <option value="5">5/4</option>
  <option value="6">6/4</option>
</select>

<div>
  <label for="bpm">BPM:</label>
  <input type="range" id="bpm" min="30" max="300" value="120">
  <span id="bpmValue">120</span>
</div>

<div id="beatContainer"></div>

<div id="controls">
  <button id="playBtn">▶</button>
  <button id="pauseBtn">⏸</button>
  <button id="stopBtn">■</button>
  <button id="tapBtn">TAP</button>
</div>

<script>
let bpm = 120;
let beatsPerMeasure = 4;
let accentIndex = 0;
let currentBeat = 0;
let intervalId = null;

const bpmSlider = document.getElementById('bpm');
const bpmValue = document.getElementById('bpmValue');
const beatContainer = document.getElementById('beatContainer');
const beatsPerMeasureSelect = document.getElementById('beatsPerMeasure');

// Web Audio API para os sons
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playClick(accent = false) {
    const osc = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    osc.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    osc.frequency.value = accent ? 1000 : 600; // som mais agudo para accent
    gainNode.gain.value = 0.2;
    osc.start();
    osc.stop(audioCtx.currentTime + 0.1);
}

// Atualiza as bolinhas
function renderBeats() {
    beatContainer.innerHTML = '';
    for (let i = 0; i < beatsPerMeasure; i++) {
        const div = document.createElement('div');
        div.classList.add('beat');
        if (i === accentIndex) div.classList.add('accent');
        if (i === currentBeat) div.classList.add('active');
        div.addEventListener('click', () => {
            accentIndex = i;
            renderBeats();
        });
        beatContainer.appendChild(div);
    }
}

// Função que toca o próximo beat
function nextBeat() {
    playClick(currentBeat === accentIndex);
    currentBeat = (currentBeat + 1) % beatsPerMeasure;
    renderBeats();
}

// Controles
document.getElementById('playBtn').addEventListener('click', () => {
    if (intervalId) return;
    const interval = 60000 / bpm;
    intervalId = setInterval(nextBeat, interval);
});
document.getElementById('pauseBtn').addEventListener('click', () => {
    clearInterval(intervalId);
    intervalId = null;
});
document.getElementById('stopBtn').addEventListener('click', () => {
    clearInterval(intervalId);
    intervalId = null;
    currentBeat = 0;
    renderBeats();
});
document.getElementById('tapBtn').addEventListener('click', () => {
    bpm = Math.min(300, bpm + 1);
    bpmSlider.value = bpm;
    bpmValue.textContent = bpm;
    if (intervalId) {
        clearInterval(intervalId);
        intervalId = setInterval(nextBeat, 60000 / bpm);
    }
});

bpmSlider.addEventListener('input', () => {
    bpm = parseInt(bpmSlider.value);
    bpmValue.textContent = bpm;
    if (intervalId) {
        clearInterval(intervalId);
        intervalId = setInterval(nextBeat, 60000 / bpm);
    }
});

beatsPerMeasureSelect.addEventListener('change', () => {
    beatsPerMeasure = parseInt(beatsPerMeasureSelect.value);
    if (accentIndex >= beatsPerMeasure) accentIndex = 0;
    currentBeat = 0;
    renderBeats();
});

// Inicializa
renderBeats();
</script>

</body>
</html>
