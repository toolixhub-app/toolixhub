<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Metronome Plus - ToolixHub</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #2c3e50;
    color: #ecf0f1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    height: 100vh;
    margin: 0;
  }
  h1 {
    margin-top: 20px;
    margin-bottom: 10px;
  }
  .controls {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 10px;
  }
  select, button {
    padding: 5px 10px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
  }
  .circle-container {
    position: relative;
    width: 200px;
    height: 200px;
    margin: 20px 0;
  }
  .circle {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 3px solid #bdc3c7;
    position: relative;
  }
  .ball {
    width: 20px;
    height: 20px;
    background-color: #e74c3c;
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(0deg);
    transform-origin: center -90px;
    transition: transform 0.05s linear;
  }
  .player-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
  }
  button.play { background-color: #2ecc71; color: #fff; }
  button.pause { background-color: #f1c40f; color: #fff; }
  button.stop { background-color: #e74c3c; color: #fff; }
  footer {
    font-size: 12px;
    margin-top: auto;
    margin-bottom: 5px;
  }
</style>
</head>
<body>

<h1>Metronome Plus</h1>

<div class="controls">
  <div>BPM: <span id="bpmDisplay">120</span></div>
  <button id="tapBtn">TAP</button>
  <label>Time Signature: 
    <select id="timeSignature">
      <option>2/4</option><option>3/4</option><option>4/4</option>
      <option>5/4</option><option>5/8</option><option>6/4</option>
      <option>6/8</option><option>7/4</option><option>7/8</option>
      <option>8/4</option><option>8/8</option><option>9/8</option>
      <option>10/8</option><option>11/8</option><option>12/8</option>
      <option>13/8</option>
    </select>
  </label>
  <div>Measure: <span id="currentMeasure">0</span></div>
</div>

<div class="controls">
  <label>Accent: <input type="checkbox" id="accentToggle" checked></label>
  <button id="soundToggle">Sound On</button>
</div>

<div class="circle-container">
  <div class="circle">
    <div class="ball" id="ball"></div>
  </div>
</div>

<div class="player-buttons">
  <button class="play" id="playBtn">&#9658;</button>
  <button class="pause" id="pauseBtn">||</button>
  <button class="stop" id="stopBtn">&#9632;</button>
</div>

<footer>Version 1.4 | ToolixHub</footer>

<script>
let bpm = 120;
let interval = null;
let currentBeat = 0;
let measureCount = 0;
let soundOn = true;
let accentOn = true;
let lastTap = 0;

const bpmDisplay = document.getElementById("bpmDisplay");
const timeSignatureSelect = document.getElementById("timeSignature");
const accentToggle = document.getElementById("accentToggle");
const soundToggle = document.getElementById("soundToggle");
const currentMeasure = document.getElementById("currentMeasure");
const ball = document.getElementById("ball");

const playBtn = document.getElementById("playBtn");
const pauseBtn = document.getElementById("pauseBtn");
const stopBtn = document.getElementById("stopBtn");
const tapBtn = document.getElementById("tapBtn");

// Audio
const click = new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_7b6f054e55.mp3?filename=click-123.mp3');
click.volume = 0.5;

function updateBPMDisplay() { bpmDisplay.textContent = bpm; }

function getBeatsPerMeasure() {
  const val = timeSignatureSelect.value.split('/')[0];
  return parseInt(val) || 4;
}

function playMetronome() {
  if(interval) return;
  const intervalMs = 60000 / bpm;
  interval = setInterval(() => {
    if(soundOn) {
      if(currentBeat === 0 && accentOn) click.play();
      else click.play();
    }
    ball.style.transform = `translate(-50%, -50%) rotate(${(360/getBeatsPerMeasure())*currentBeat}deg)`;
    currentBeat++;
    if(currentBeat >= getBeatsPerMeasure()) {
      currentBeat = 0;
      measureCount++;
      currentMeasure.textContent = measureCount;
    }
  }, intervalMs);
}

function pauseMetronome() {
  clearInterval(interval);
  interval = null;
}

function stopMetronome() {
  pauseMetronome();
  currentBeat = 0;
  measureCount = 0;
  currentMeasure.textContent = measureCount;
  ball.style.transform = `translate(-50%, -50%) rotate(0deg)`;
}

playBtn.onclick = playMetronome;
pauseBtn.onclick = pauseMetronome;
stopBtn.onclick = stopMetronome;

timeSignatureSelect.onchange = () => {
  currentBeat = 0;
  ball.style.transform = `translate(-50%, -50%) rotate(0deg)`;
}

accentToggle.onchange = () => accentOn = accentToggle.checked;

soundToggle.onclick = () => {
  soundOn = !soundOn;
  soundToggle.textContent = soundOn ? 'Sound On' : 'Sound Off';
}

// Tap tempo
tapBtn.onclick = () => {
  const now = Date.now();
  if(lastTap) {
    const diff = now - lastTap;
    bpm = Math.round(60000 / diff);
    updateBPMDisplay();
  }
  lastTap = now;
}
</script>
</body>
</html>
