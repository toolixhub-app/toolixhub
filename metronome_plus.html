<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Metronome Full</title>
<style>
  body {
    background-color: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
  }
  h1 {
    font-size: 32px;
    margin-bottom: 10px;
  }
  .controls, .bpm-control, .beats {
    margin: 20px 0;
  }
  button {
    background-color: #222;
    color: #fff;
    border: 1px solid #555;
    padding: 10px 15px;
    font-size: 20px;
    margin: 0 5px;
    cursor: pointer;
  }
  button:hover {
    background-color: #444;
  }
  .slider {
    width: 200px;
  }
  .beats {
    display: flex;
    justify-content: center;
    margin-top: 20px;
  }
  .beat {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    margin: 0 8px;
    background-color: #444;
    cursor: pointer;
  }
  .beat.current {
    background-color: #fff;
  }
  .beat.accent {
    background-color: red;
  }
  select {
    background-color: #222;
    color: #fff;
    border: 1px solid #555;
    padding: 5px;
    font-size: 16px;
  }
</style>
</head>
<body>

<h1>Metronome Full</h1>

<div class="top-controls">
  <label for="beatsPerMeasure">Beats per measure:</label><br>
  <select id="beatsPerMeasure">
    <option value="2">2/4</option>
    <option value="3">3/4</option>
    <option value="4" selected>4/4</option>
    <option value="5">5/4</option>
    <option value="6">6/4</option>
  </select>
</div>

<div class="bpm-control">
  <label>BPM:
    <input type="range" id="bpmSlider" class="slider" min="30" max="300" value="120">
  </label>
  <span id="bpmValue">120</span>
  <button id="tapBtn">TAP</button>
</div>

<div class="controls">
  <button id="playBtn">‚ñ∂</button>
  <button id="pauseBtn">‚è∏</button>
  <button id="stopBtn">‚ñ†</button>
  <button id="soundBtn">üîä</button>
</div>

<div class="beats" id="beatsContainer">
  <!-- Bolinhas de beat v√£o aparecer aqui -->
</div>

<audio id="soundNormal" src="click_normal.wav"></audio>
<audio id="soundAccent" src="click_accent.wav"></audio>

<script>
let bpm = 120;
let timeSig = 4;
let accentIndex = 0;
let currentBeat = 0;
let isPlaying = false;
let intervalId;
let lastTap = 0;
let soundOn = true;

const bpmSlider = document.getElementById('bpmSlider');
const bpmValue = document.getElementById('bpmValue');
const beatsContainer = document.getElementById('beatsContainer');
const playBtn = document.getElementById('playBtn');
const pauseBtn = document.getElementById('pauseBtn');
const stopBtn = document.getElementById('stopBtn');
const soundBtn = document.getElementById('soundBtn');
const tapBtn = document.getElementById('tapBtn');
const beatsPerMeasureSelect = document.getElementById('beatsPerMeasure');
const soundNormal = document.getElementById('soundNormal');
const soundAccent = document.getElementById('soundAccent');

function updateBeats() {
  beatsContainer.innerHTML = '';
  for(let i = 0; i < timeSig; i++) {
    const beat = document.createElement('div');
    beat.classList.add('beat');
    if(i === currentBeat) beat.classList.add('current');
    if(i === accentIndex) beat.classList.add('accent');
    beat.addEventListener('click', () => {
      accentIndex = i;
      renderBeats();
    });
    beatsContainer.appendChild(beat);
  }
}

function renderBeats() {
  const beatDivs = document.querySelectorAll('.beat');
  beatDivs.forEach((b, i) => {
    b.classList.remove('current');
    b.classList.remove('accent');
    if(i === currentBeat) b.classList.add('current');
    if(i === accentIndex) b.classList.add('accent');
  });
}

function playClick() {
  if(!soundOn) return;
  if(currentBeat === accentIndex) {
    soundAccent.currentTime = 0;
    soundAccent.play();
  } else {
    soundNormal.currentTime = 0;
    soundNormal.play();
  }
}

function startMetronome() {
  if(isPlaying) return;
  isPlaying = true;
  const interval = 60000 / bpm;
  intervalId = setInterval(() => {
    playClick();
    currentBeat = (currentBeat + 1) % timeSig;
    renderBeats();
  }, interval);
}

function pauseMetronome() {
  clearInterval(intervalId);
  isPlaying = false;
}

function stopMetronome() {
  clearInterval(intervalId);
  isPlaying = false;
  currentBeat = 0;
  renderBeats();
}

// Eventos
bpmSlider.addEventListener('input', () => {
  bpm = parseInt(bpmSlider.value);
  bpmValue.textContent = bpm;
  if(isPlaying) {
    pauseMetronome();
    startMetronome();
  }
});

beatsPerMeasureSelect.addEventListener('change', () => {
  timeSig = parseInt(beatsPerMeasureSelect.value);
  if(accentIndex >= timeSig) accentIndex = 0;
  currentBeat = 0;
  renderBeats();
  updateBeats();
});

playBtn.addEventListener('click', startMetronome);
pauseBtn.addEventListener('click', pauseMetronome);
stopBtn.addEventListener('click', stopMetronome);
soundBtn.addEventListener('click', () => {
  soundOn = !soundOn;
  soundBtn.textContent = soundOn ? "üîä" : "üîá";
});

// TAP Button
tapBtn.addEventListener('click', () => {
  const now = Date.now();
  if(lastTap) {
    const newBpm = 60000 / (now - lastTap);
    bpm = Math.round(Math.min(Math.max(newBpm, 30), 300));
    bpmSlider.value = bpm;
    bpmValue.textContent = bpm;
    if(isPlaying) {
      pauseMetronome();
      startMetronome();
    }
  }
  lastTap = now;
});

// Inicializa
updateBeats();
renderBeats();
</script>

</body>
</html>
